-- ***************************** SqlDBM: Snowflake ****************************
-- * Generated by SqlDBM: MART SCHEMA, v18 by lesya.rylova+standard@gmail.com *


-- ************************************** VALIDATION_DATA_PRE_MODEL_DEFAULT_CHECKS
CREATE VIEW VALIDATION_DATA_PRE_MODEL_DEFAULT_CHECKS AS
WITH
 NO_LONG_HAUL_COST AS (SELECT LANE_ORIGIN_FAC_ID, LANE_DESTINATION_FAC_ID FROM PRE_MODEL_TRANSFER_COSTS WHERE LONG_HAUL_COST IS NULL)
,NO_LOAD_SIZE      AS (SELECT LANE_ORIGIN_FAC_ID, LANE_DESTINATION_FAC_ID FROM PRE_MODEL_TRANSFER_COSTS WHERE LOAD_SIZE IS NULL)
,NO_UNIT_COST      AS (SELECT FAC_ID, WASTE_TYPE FROM PRE_MODEL_FACILITIES_MATERIAL WHERE UNIT_COST IS NULL)
,NO_UNIT_PRICE     AS (SELECT FAC_ID, WASTE_TYPE FROM PRE_MODEL_FACILITIES_MATERIAL WHERE UNIT_PRICE IS NULL)
--,NO_UNIT_REVENUE   AS (SELECT FAC_ID, WASTE_TYPE FROM PRE_MODEL_FACILITIES_MATERIAL WHERE UNIT_REVENUE IS NULL)
,NO_TURN_TIME      AS (SELECT FAC_ID FROM PRE_MODEL_FACILITIES WHERE TURN_TIME IS NULL)
--,NO_FIXED_COST     AS (SELECT FAC_ID FROM PRE_MODEL_FACILITIES WHERE FIXED_COST IS NULL)

SELECT TABLE_NM
      ,test_NM
      ,CNT
      ,RECORDS_WITH_NULL
      ,TABLE_NM || ' HAS ' || CNT || ' INSTANCES WITH ' || test_NM || ': ' || RECORDS_WITH_NULL AS DETAIL
FROM
(
 SELECT 'PRE_MODEL_TRANSFER_COSTS' AS TABLE_NM
       ,'No long haul cost supplied' AS test_NM
       ,COUNT(*) AS CNT
       ,LISTAGG( '(' || LANE_ORIGIN_FAC_ID || ',' || LANE_DESTINATION_FAC_ID || ')', ', ' ) WITHIN GROUP(ORDER BY LANE_ORIGIN_FAC_ID, LANE_DESTINATION_FAC_ID) AS RECORDS_WITH_NULL
 FROM NO_LONG_HAUL_COST

 UNION ALL

 SELECT 'PRE_MODEL_TRANSFER_COSTS' AS TABLE_NM
       ,'No average load size supplied' AS test_NM
       ,COUNT(*) AS CNT
       ,LISTAGG( '(' || LANE_ORIGIN_FAC_ID || ',' || LANE_DESTINATION_FAC_ID || ')', ', ' ) WITHIN GROUP(ORDER BY LANE_ORIGIN_FAC_ID, LANE_DESTINATION_FAC_ID) AS RECORDS_WITH_NULL
 FROM NO_LOAD_SIZE

 UNION ALL

 SELECT 'PRE_MODEL_FACILITIES_MATERIAL' AS TABLE_NM
       ,'No unit cost per ton supplied' AS test_NM
       ,COUNT(*) AS CNT
       ,LISTAGG( '(' || FAC_ID || ',' || WASTE_TYPE || ')', ', ' ) WITHIN GROUP(ORDER BY FAC_ID, WASTE_TYPE) AS RECORDS_WITH_NULL
 FROM NO_UNIT_COST

 UNION ALL

 SELECT 'PRE_MODEL_FACILITIES_MATERIAL' AS TABLE_NM
       ,'No unit price per ton supplied' AS test_NM
       ,COUNT(*) AS CNT
       ,LISTAGG( '(' || FAC_ID || ',' || WASTE_TYPE || ')', ', ' ) WITHIN GROUP(ORDER BY FAC_ID, WASTE_TYPE) AS RECORDS_WITH_NULL
 FROM NO_UNIT_PRICE

-- UNION ALL

-- SELECT 'PRE_MODEL_FACILITIES_MATERIAL' AS TABLE_NM
--       ,'NULLS IN UNIT_REVENUE' AS test_NM
--       ,COUNT(*) AS CNT
--       ,LISTAGG( '(' || FAC_ID || ',' || WASTE_TYPE || ')', ', ' ) WITHIN GROUP(ORDER BY FAC_ID, WASTE_TYPE) AS RECORDS_WITH_NULL
-- FROM NO_UNIT_REVENUE

 UNION ALL

 SELECT 'PRE_MODEL_FACILITIES' AS TABLE_NM
       ,'No facility turn time supplied' AS test_NM
       ,COUNT(*) AS CNT
       ,LISTAGG( FAC_ID, ', ' ) WITHIN GROUP(ORDER BY FAC_ID) AS RECORDS_WITH_NULL
 FROM NO_TURN_TIME

-- UNION ALL

-- SELECT 'PRE_MODEL_FACILITIES' AS TABLE_NM
--       ,'NULLS IN FIXED_COST' AS test_NM
--       ,COUNT(*) AS CNT
--       ,LISTAGG( FAC_ID, ', ' ) WITHIN GROUP(ORDER BY FAC_ID) AS RECORDS_WITH_NULL
-- FROM NO_FIXED_COST
)
WHERE CNT > 0
ORDER BY TABLE_NM, test_NM
;
