-- ***************************** SqlDBM: Snowflake ****************************
-- * Generated by SqlDBM: MART SCHEMA, v18 by lesya.rylova+standard@gmail.com *


-- ************************************** S0_ACTIVE_SITES
CREATE VIEW S0_ACTIVE_SITES as

with 

S0_PMT as (

select FAC_IDU,       'TS' as location_type

      from STG.PMT_TRANSFER_ROLLUP

      where (DATA_DT  between $start_date and $end_date ) and ROLLUP_TYPE='M' and TOT_TONS > 0            group by FAC_IDU

      UNION ALL          

      select FAC_IDU, 'MRF' as location_type

      from STG.PMT_RECYCLING_ROLLUP

      where (DATA_DT  between $start_date and $end_date ) and ROLLUP_TYPE='M' and TOT_TONS > 0

      group by FAC_IDU

      UNION ALL        

      select FAC_IDU, 'LF' as location_type

      from STG.PMT_DISPOSAL_ROLLUP

      where (DATA_DT  between $start_date and $end_date ) and ROLLUP_TYPE='M' and TOT_TONS > 0

      group by FAC_IDU ) 

select  FAC_ID from

(

select FAC_IDU||'-'||location_type as FAC_ID from S0_PMT 

);
