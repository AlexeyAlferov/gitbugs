-- ***************************** SqlDBM: Snowflake ****************************
-- * Generated by SqlDBM: MART SCHEMA, v18 by lesya.rylova+standard@gmail.com *


-- ************************************** VALIDATION_DATA_LIMITED_TRUCK_CAPACITY
CREATE VIEW VALIDATION_DATA_LIMITED_TRUCK_CAPACITY AS
SELECT HC.FAC_ID
      ,HC.SUBLOB
      ,HC.TRUCK_CAPACITY / HSC.TRUCK_CNT / $DAYS as HRS_PER_TRUCK
      ,'Daily truck hours at Hauling site ' || SUBSTR(HC.FAC_ID,1,6) || ' sublob ' || HC.SUBLOB || ' is ' || round(HRS_PER_TRUCK,2) || ', which exceeds threshold of 15 hrs/day' AS DETAIL
      ,SUBSTR(HC.FAC_ID,1,6) AS LH_PARM_1
      ,'COLLECTION' AS LH_PARM_2
      ,HC.SUBLOB AS LH_PARM_3
      ,NULL AS LH_PARM_4
      ,NULL AS LH_PARM_5      
FROM model_hrs_cap HC
LEFT JOIN HAULING_SITE_CAPACITY HSC
    ON HSC.FAC_ID = SUBSTR(HC.FAC_ID,1,6) --model_hrs_cap FAC_ID has *_DEPOT, so using substr to match with HSC.FAC_ID
    AND HSC.SUBLOB = HC.SUBLOB
WHERE HRS_PER_TRUCK > 15;
