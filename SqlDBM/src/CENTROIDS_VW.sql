-- ***************************** SqlDBM: Snowflake ****************************
-- * Generated by SqlDBM: MART SCHEMA, v18 by lesya.rylova+standard@gmail.com *


-- ************************************** CENTROIDS_VW
CREATE VIEW CENTROIDS_VW AS 
--
-- Centroids fact at depot, route, lob grain - used to set defaults if value not available
--
select
DepotFacId
 	, routeid
   , lob 
  , avg(longitude) as longitude
  , avg(LATITUDe) as latitude
  , count(*)  as stop
from MART.CENTROIDS_FACT 
where service_dt between $start_date and $end_date
and (depotfacid in (select FAC_ID from MART.HAULING_SITE WHERE MARKET_AREA_CD = $MARKET_AREA))
group by  DepotFacId, routeid, lob;
