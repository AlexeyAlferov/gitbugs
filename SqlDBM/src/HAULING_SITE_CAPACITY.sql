-- ***************************** SqlDBM: Snowflake ****************************
-- * Generated by SqlDBM: MART SCHEMA, v18 by lesya.rylova+standard@gmail.com *


-- ************************************** HAULING_SITE_CAPACITY
CREATE VIEW HAULING_SITE_CAPACITY as
select
coalesce( t1.FAC_ID, t2.FAC_ID) as FAC_ID,
coalesce( t1.SUBLOB, t2.SUBLOB) as SUBLOB,
coalesce( t1.LOB, t2.LOB) as LOB,
coalesce( t1.TRUCK_CNT , t2.TRUCK_CNT) as TRUCK_CNT, --   Corporate Truck count versus BMT
TRUCK_CAPACITY_CNT,
LAST_UPDATED_DTM,
LAST_UPDATED_USER,
HOURS_PER_TRUCK ,
coalesce( t1.PERCENTAGE_HOURS_ON_SAT, t2.PERCENTAGE_HOURS_ON_SAT) as PERCENTAGE_HOURS_ON_SAT,
t2.LCPH AS LABOR_COST_PER_HOUR ,     
t2.MCPH AS MAINTENANCE_COST_PER_HOUR,     
t2.FCPH AS FUEL_COST_PER_HOUR,
coalesce(t1.VEHICLE_COST_PER_HOUR , t2.VCPH) AS VEHICLE_COST_PER_HOUR      -- Essbase truck count versus BMT.
from BMT_HAULING_SITE_CAPACITY t1 full outer join
     ( SELECT coalesce(t1.FAC_ID, t2.FAC_ID) as FAC_ID,                     -- Full outer join the 2 corporate tables to get all the VCPH and Truck Count
              coalesce(t1.SUBLOB, t2.SUBLOB) as SUBLOB,
              coalesce(t1.LOB, t2.LOB) as LOB, TRUCK_CNT, PERCENTAGE_HOURS_ON_SAT,LCPH,MCPH,FCPH,VCPH from
        ( SELECT FAC_ID, t1.SUBLOB, LOB, TRUCK_CNT, PERCENTAGE_HOURS_ON_SAT from
          CORP_HAULING_SITE_CAPACITY t1, SUBLOB_HIERARCHY t2 where t1.sublob = t2.sublob) t1 full outer join    -- get LOB given SUBLOB
            (
              SELECT FAC_ID
               ,SUBLOB_CD as SUBLOB
               ,LOB_CD as LOB         
               ,lcph
               ,mcph
               ,fcph
               ,vcph
             FROM CORP_HAULING_SITE_COSTS  -- Already exploded from LOB to SUBLOB
            ) t2
            on t1.fac_id = t2.fac_id and t1.sublob = t2.sublob
      ) t2
      on t1.fac_id = t2.fac_id and t1.sublob = t2.sublob
where nvl(DATA_COLLCTION_ADD_DELETE_UPDATE,'A') != 'D';
