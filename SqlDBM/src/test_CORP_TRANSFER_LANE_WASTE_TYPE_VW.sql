-- ***************************** SqlDBM: Snowflake ****************************
-- * Generated by SqlDBM: MART SCHEMA, v18 by lesya.rylova+standard@gmail.com *


-- ************************************** test_CORP_TRANSFER_LANE_WASTE_TYPE_VW
CREATE VIEW test_CORP_TRANSFER_LANE_WASTE_TYPE_VW as (SELECT 
  "LANE_ORIGIN_FAC_ID", 
  "WASTE_TYPE", 
  "LANE_DESTINATION_FAC_ID", 
  "LANE_NAME", 
  "LONG_HAUL_COST", 
  "AVERAGE_LOAD_SIZE_TONS" 
FROM (SELECT t3.LANE_ORIGIN_FAC_ID
	, t1.WASTE_TYPE
	, t3.LANE_DESTINATION_FAC_ID
	, LANE_NAME
	, coalesce (LONG_HAUL_COST,
                      median(LONG_HAUL_COST) over (partition by WASTE_TYPE)) as LONG_HAUL_COST
	, t4.AVERAGE_LOAD_SIZE_TONS
FROM  DEV_ONEWM.MART.CORP_WASTE_TYPE_ACCEPTANCE t1 
join DEV_ONEWM.MART.CORP_DISPOSAL_SITE t2 on T1.FAC_ID = T2.FAC_ID
      JOIN  DEV_ONEWM.MART.TRANSFER_LANES t3 ON T2.FAC_ID = T3.LANE_ORIGIN_FAC_ID
      LEFT JOIN DEV_ONEWM.MART.test_TMS_TONS t4 ON T3.LANE_ORIGIN_FAC_ID = T4.LANE_ORIGIN_FAC_ID and substring(t3.LANE_DESTINATION_FAC_ID,1,6) = T4.LANE_DESTINATION_FAC_ID
      WHERE T2.FAC_TYPE = 'TS'
) AS "v_0000000307_0000040686");
