-- ***************************** SqlDBM: Snowflake ****************************
-- * Generated by SqlDBM: MART SCHEMA, v18 by lesya.rylova+standard@gmail.com *


-- ************************************** OCS_TONNAGE
CREATE VIEW OCS_TONNAGE AS



SELECT DepotFacId AS HAULING_SITE_id

	,OCS_DISPOSAL_CD AS OCS_DISPOSAL_CD

	,MAX(OCS_DISPOSAL_NM) AS OCS_DISPOSAL_NM

	,SUM(TONS) AS TONS

	,MAX(SERVICE_DT) AS LAST_SERVICE_DT

FROM (

	SELECT DepotFacId

		,OCS_DISPOSAL_CD

		,OCS_DISPOSAL_NM

		,round(nvl(sum(TONS), 0), 2) AS TONS

		,MAX(SERVICE_DT) AS SERVICE_DT

	FROM COMRES_FACT

	GROUP BY DepotFacId

		,OCS_DISPOSAL_CD

		,OCS_DISPOSAL_NM



	UNION



	SELECT DepotFacId

		,OCS_DISPOSAL_CD

		,OCS_DISPOSAL_NM

		,round(nvl(sum(TONS), 0), 2) AS TONS,

		MAX(SERVICE_DT) AS SERVICE_DT

	FROM ROLLOFF_FACT

	GROUP BY DepotFacId

		,OCS_DISPOSAL_CD

		,OCS_DISPOSAL_NM

	)

GROUP BY DepotfacId

	,OCS_DISPOSAL_CD

;
