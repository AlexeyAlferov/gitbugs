-- ***************************** SqlDBM: Snowflake ****************************
-- * Generated by SqlDBM: MART SCHEMA, v18 by lesya.rylova+standard@gmail.com *


-- ************************************** WASTE_TYPE_ACCEPTANCE
CREATE VIEW WASTE_TYPE_ACCEPTANCE as
WITH lf_and_ts_costs as
(
  --Get ESSBASE costs that are greater than $1.00 per ton; credible threshold for computed costs per ton
--
-- NETOPT-2103:DA - remove unnecessary fields 
--
SELECT fac_id, DCPT AS UNIT_COST_PER_TON FROM LF_DISPOSAL_COSTS lf  WHERE DCPT>0
UNION ALL
SELECT fac_id, DCPT AS UNIT_COST_PER_TON FROM TS_DISPOSAL_COSTS lf  WHERE DCPT>0
)
select
    coalesce(t1.FAC_ID, t2.FAC_ID) as FAC_ID,
    coalesce(t1.WASTE_TYPE, t2.WASTE_TYPE) as WASTE_TYPE,
    coalesce(t1.ACCEPTED_FLAG, T2.ACCEPTED_FLAG) as ACCEPTED_FLAG,
    COALESCE(t1.UNIT_COST_PER_TON, essbase.UNIT_COST_PER_TON) as UNIT_COST_PER_TON,
    coalesce(t1.UNIT_PRICE_PER_TON, t2.UNIT_PRICE) as UNIT_PRICE_PER_TON,
    UNIT_REVENUE_PER_TON,
    case
        when t1.FAC_ID is not null then t1.SOURCE
        else 'MART'
    end as SOURCE,
    LAST_UPDATED_DTM,
    LAST_UPDATED_USER
from
    BMT_WASTE_TYPE_ACCEPTANCE t1
    full outer join CORP_WASTE_TYPE_ACCEPTANCE t2 on t1.fac_Id = t2.fac_Id and t1.waste_type = t2.waste_Type
    left join lf_and_ts_costs essbase on T1.FAC_ID=essbase.FAC_ID or T2.FAC_ID=essbase.FAC_ID
    where nvl(DATA_COLLCTION_ADD_DELETE_UPDATE,'A') != 'D';
