-- ***************************** SqlDBM: Snowflake ****************************
-- * Generated by SqlDBM: MART SCHEMA, v18 by lesya.rylova+standard@gmail.com *


-- ************************************** CENTROIDS_MASTER_VW
CREATE VIEW CENTROIDS_MASTER_VW as
--
-- Used to set defaults at the master route level if actual value not available
--
select
DepotFacId
 	, substr(ROUTEID,1,1)||'_'||substr(ROUTEID,3,2) as Group_Id
  , avg(longitude) as longitude
  , avg(LATITUDe) as latitude
  , count(*)  as stop
from MART.CENTROIDS_FACT
where service_dt between $start_date and $end_date
and (depotfacid in (select FAC_ID from MART.HAULING_SITE WHERE MARKET_AREA_CD = $MARKET_AREA))
group by  DepotFacId, substr(ROUTEID,1,1)||'_'||substr(ROUTEID,3,2);
