-- ***************************** SqlDBM: Snowflake ****************************
-- * Generated by SqlDBM: MART SCHEMA, v18 by lesya.rylova+standard@gmail.com *


-- ************************************** VALIDATION_DATA_CPS_WITH_NO_TMS_HISTORICAL_TONNAGE
CREATE VIEW VALIDATION_DATA_CPS_WITH_NO_TMS_HISTORICAL_TONNAGE AS

SELECT SUM(CP_TONS) AS CP_TONS,

	 'Transfer Station ' || LANE_ORIGIN_FAC_ID ||' with waste type '|| WASTE_TYPE || ' has '||round(SUM(CP_TONS),2)||' incoming CP tons but no TMS Historical Tonnage' AS DETAIL

    ,SUBSTR(LANE_ORIGIN_FAC_ID,1,6) AS LH_PARM_1

	,LH_FAC_TYPE(LANE_ORIGIN_FAC_ID)  AS LH_PARM_2

	,WASTE_TYPE AS LH_PARM_3

	,NULL AS LH_PARM_4

	,NULL AS LH_PARM_5

FROM MART.MODEL_TRANSFER_COSTS

WHERE CP_TONS IS NOT NULL

GROUP BY LANE_ORIGIN_FAC_ID, WASTE_TYPE HAVING MAX (TMS_HIST_PCT) IS NULL

;
