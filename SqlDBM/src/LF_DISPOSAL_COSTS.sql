-- ***************************** SqlDBM: Snowflake ****************************
-- * Generated by SqlDBM: MART SCHEMA, v18 by lesya.rylova+standard@gmail.com *


-- ************************************** LF_DISPOSAL_COSTS
CREATE VIEW LF_DISPOSAL_COSTS as (SELECT 
  "FAC_ID", 
  "BU_ID", 
  "LOB", 
  "NON_DEPLETION_DISPOSAL_COST", 
  "DEPLETION_DISPOSAL_COST", 
  "TOTAL_DISPOSAL_VOLUME", 
  "NON_DEPLETION_DCPT", 
  "DEPLETION_DCPT", 
  "DCPT" 
FROM (SELECT RFF.FAC_IDU||'_Disposal' as FAC_ID
,BU_ID
,LOB
,NON_DEPLETION_DISPOSAL_COST
,DEPLETION_DISPOSAL_COST
,TOTAL_DISPOSAL_VOLUME
,NON_DEPLETION_DISPOSAL_COST/(CASE WHEN TOTAL_DISPOSAL_VOLUME = 0 THEN NULL ELSE TOTAL_DISPOSAL_VOLUME END) AS NON_DEPLETION_DCPT
,DEPLETION_DISPOSAL_COST/(CASE WHEN TOTAL_DISPOSAL_VOLUME = 0 THEN NULL ELSE TOTAL_DISPOSAL_VOLUME END) AS DEPLETION_DCPT
,(NVL(NON_DEPLETION_DCPT,0)+NVL(DEPLETION_DCPT,0)) AS DCPT
FROM
(
  SELECT
  ORGANIZATION AS BU_ID
  ,'LF' LOB
  ,SUM(D500_DISPOSAL_FEES_AND_TAXES +
      D600_MAINTENANCE_LUBRICANTS +
      D600_MAINTENANCE_PARTS_SUPPLIES +
      D600_A524000_PRIMARY_SHOP_COSTS_THIRD_PARTY_REPAIRS +
      D600_A524900_PRIMARY_SHOP_COSTS_OTHER_THIRD_PARTY_MAINTENANCE +
      D600_MAINTENANCE_TIRES +
      D600_CONTRACT_LABOR +
      D600_A514000_PRIMARY_SHOP_COSTS_EMPLOYER_401K_MATCHING +
      D600_A514950_PRIMARY_SHOP_COSTS_PENSION_EXPENSE_UNION +
      D600_PAYROLL_TAX_EXPENSE +
      D600_WAGES_HOURLY +
      D600_WAGES_OVERTIME +
      D600_FUEL +
      D780_A571100_LANDFILL_ROYALTIES_AIRSPACE_HOST_COMMUNITY_FEES +
      D780_A571300_LANDFILL_ROYALTIES_AIRSPACE_LF_LEASE_CONTINGENT_PAYMENTS +
      D780_ROYALTIES
  ) AS NON_DEPLETION_DISPOSAL_COST
  ,SUM(D780_A704000_LANDFILL_ROYALTIES_AIRSPACE_NON143_AIRSPACE_AMORTIZATION +
      D780_A704100_LANDFILL_ROYALTIES_AIRSPACE_LF_CAPPING_AMORTIZATION +
      D780_A704400_LANDFILL_ROYALTIES_AIRSPACE_LF_CLOS_POST_CLOS_AMORTIZATION
  ) AS DEPLETION_DISPOSAL_COST
  ,SUM(TOTAL_EXTERNAL_TONS + TOTAL_INTERNAL_TONS) AS TOTAL_DISPOSAL_VOLUME
  FROM DEV_ESSBASE.ODS.ESSBASE_DISPOSAL_COST t1
  WHERE to_date('01-'||TIME,'DD-MON-YY') >= add_months(current_date(),-12)
  GROUP BY BU_ID, 'LF'
) DCPT
LEFT JOIN
(
  SELECT DISTINCT FAC_BUS_UNIT_IDU, FAC_IDU FROM DEV_CORPDB.ODS.RDN2_FAC_FULL
) RFF
ON DCPT.BU_ID = RFF.FAC_BUS_UNIT_IDU
) AS "v_0000017686_0000143785");
