-- ***************************** SqlDBM: Snowflake ****************************
-- * Generated by SqlDBM: MART SCHEMA, v18 by lesya.rylova+standard@gmail.com *


-- ************************************** BMT_DISPOSAL_SITE_LOB
CREATE VIEW BMT_DISPOSAL_SITE_LOB as

select * from

(select

	FAC_ID ||'_' ||case when FAC_TYPE = 'Transfer Station' then 'TS'

	                when FAC_TYPE = 'MRF Recycling' then 'MRF'

	                else FAC_TYPE end as FAC_ID,

	LOB_CD,

	CYCLE_MINUTE_CNT,

	LAST_UPDATED_DTM,

	LAST_UPDATED_USER,

	DATA_COLLCTION_ADD_DELETE_UPDATE,

	row_number() over (partition by fac_id, fac_type, lob_cd order by last_updated_dtm desc nulls last) as rnk

	 from stg.FACILITY_DISPOSAL_SITE_LOB_BMT_DATA_COLLCTN

 where fac_type != 'Collection')  where rnk=1;
