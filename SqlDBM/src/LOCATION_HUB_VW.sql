-- ***************************** SqlDBM: Snowflake ****************************
-- * Generated by SqlDBM: MART SCHEMA, v18 by lesya.rylova+standard@gmail.com *


-- ************************************** LOCATION_HUB_VW
CREATE VIEW LOCATION_HUB_VW as (SELECT 
  "FAC_ID", 
  "LOCATION_NAME", 
  "LONGITUDE", 
  "LATITUDE", 
  "ADDRESS_1", 
  "ADDRESS_2", 
  "CITY_NM", 
  "STATE_CD", 
  "ZIP_CD", 
  "COUNTRY_CD", 
  "COUNTY_NM", 
  "RNK" 
FROM (select * from 
     (select LOCATION_CD as FAC_ID, LOCATION_NAME, 
            case when MANUAL_LONGITUDE < 0 AND MANUAL_LONGITUDE IS NOT NULL THEN MANUAL_LONGITUDE ELSE LONGITUDE END as LONGITUDE,
            case when MANUAL_LATITUDE  > 0 AND MANUAL_LATITUDE  IS NOT NULL THEN MANUAL_LATITUDE ELSE LATITUDE END as LATITUDE,
      ADDRESS_1,ADDRESS_2,CITY_NM,STATE_CD,ZIP_CD,COUNTRY_CD ,COUNTY_NM, row_number() over (partition by LOCATION_CD order by longitude desc nulls last) as rnk
      FROM DEV_TMS.ODS.WML_LH_LOCATION ) t1 where rnk=1
) AS "v_0000017686_0000143670");
