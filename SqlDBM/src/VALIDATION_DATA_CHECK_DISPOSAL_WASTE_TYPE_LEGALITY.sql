-- ***************************** SqlDBM: Snowflake ****************************
-- * Generated by SqlDBM: MART SCHEMA, v18 by lesya.rylova+standard@gmail.com *


-- ************************************** VALIDATION_DATA_CHECK_DISPOSAL_WASTE_TYPE_LEGALITY
CREATE VIEW VALIDATION_DATA_CHECK_DISPOSAL_WASTE_TYPE_LEGALITY AS
SELECT CP.DISPFACID AS DISPOSAL_FACILITY_ID
      ,CP.WASTE_TYPE,CP.TOTAL_TONNAGE AS TOTAL_TONS,
      'Facility '||CP.DISPFACID|| ' does not accept waste type '||CP.WASTE_TYPE||' but has accepted historic tonnage of ' || round(CAST(CP.TOTAL_TONNAGE AS STRING),2) ||
         ' tons and has '||CAST(CP.NUMBER_OF_RECORDS AS STRING)|| ' collection points for this waste type'
         AS DETAIL
	,SUBSTR(CP.DISPFACID,1,6) AS LH_PARM_1
	,LH_FAC_TYPE(CP.DISPFACID)  AS LH_PARM_2
	,CP.WASTE_TYPE AS LH_PARM_3
	,NULL AS LH_PARM_4
	,NULL AS LH_PARM_5
FROM VALIDATION_DATA_COLLECTION_POINT_SUMMARY CP
INNER JOIN MODEL_FACILITIES_MATERIAL FM ON FM.FAC_ID=CP.DISPFACID AND FM.WASTE_TYPE = CP.WASTE_TYPE
WHERE UPPER(FM.ACCEPTED_FLAG) = 'N'
;
