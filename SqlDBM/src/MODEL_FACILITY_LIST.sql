-- ***************************** SqlDBM: Snowflake ****************************
-- * Generated by SqlDBM: MART SCHEMA, v18 by lesya.rylova+standard@gmail.com *


-- ************************************** MODEL_FACILITY_LIST
CREATE VIEW MODEL_FACILITY_LIST AS

with historical_HAULING_SITE  as (select distinct depotfacid as fac_id from MART.MODEL_COLLECTION_POINTS),

     historical_disposal  as (select distinct dispfacid as fac_id from MART.MODEL_COLLECTION_POINTS),

     proximity_disposal as (select DISPOSAL_FAC_ID as fac_id from MART.MARKET_AREA_SITE_PROXIMITY),

     FLOW_CONTROL_disposal as (select DEST_DISPOSAL_SITE_ID as FAC_ID from MART.FLOW_CONTROL

                               WHERE ACTIVE_FLAG='A'

                               AND SRC_MARKET_AREA_CD=$MARKET_AREA

                               AND DEST_DISPOSAL_SITE_ID IS NOT NULL

                               AND DEST_DISPOSAL_SITE_ID != ''),

     total_disposal as (select fac_id from historical_disposal

                       union all

                       select fac_id from proximity_disposal

                        union all

                       select fac_id from FLOW_CONTROL_disposal),

      transfer_station_dest as (

       SELECT DISTINCT lane_destination_fac_id AS fac_id

       FROM TRANSFER_LANE_WASTE_TYPE WHERE lane_origin_fac_id in (SELECT DISTINCT fac_id FROM total_disposal)

       AND UPPER(STATUS_IND)='A'

     )

select distinct fac_id from

(select * from historical_HAULING_SITE

union all

select * from total_disposal

union all

select * from transfer_station_dest

)

;
