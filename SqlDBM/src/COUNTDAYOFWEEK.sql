-- ***************************** SqlDBM: Snowflake ****************************
-- * Generated by SqlDBM: MART SCHEMA, v18 by lesya.rylova+standard@gmail.com *


-- ************************************** COUNTDAYOFWEEK
CREATE FUNCTION COUNTDAYOFWEEK(START_DATE DATE, END_DATE DATE, DAYOFWEEK VARIANT)
RETURNS VARIANT
LANGUAGE JAVASCRIPT
AS '

  Date.prototype.addDays = function (days) {

      var date = new Date(this.valueOf());

      date.setDate(date.getDate() + days);

      return date;

  };



   var numDays = 0;

   var currentDate = new Date(START_DATE);

   while (currentDate <= END_DATE) {

            //count specified day of week 0=Sunday, 1=Monday ... 6=Saturday

            if (currentDate.getDay() == DAYOFWEEK) { numDays++; }

        currentDate = currentDate.addDays(1);

     };

    return numDays;

 ';
