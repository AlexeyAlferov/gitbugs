-- ***************************** SqlDBM: Snowflake ****************************
-- * Generated by SqlDBM: MART SCHEMA, v18 by lesya.rylova+standard@gmail.com *


-- ************************************** WBJ_ACCEPTANCE
CREATE VIEW WBJ_ACCEPTANCE AS 

      select * from 

      (SELECT  CODE||'_'|| case  when FAMILY = 'DL'  then 'Disposal'

                                when FAMILY = 'CO'  then 'Compost'

                                when FAMILY = 'IN'  then 'Energy' 

                                else FAMILY end as FAC_ID,

              case  when contains(WASTE_TYPES_ACCEPTED,'C&D')  then 'Y' 

                    when contains(WASTE_TYPES_NOT_ACCEPTED,'C&D')  then 'N' 

                    else null end as C_D,

	            case  when contains(WASTE_TYPES_ACCEPTED,'MSW')  then 'Y'

                    when contains(WASTE_TYPES_NOT_ACCEPTED,'MSW')  then 'N' 

                    else null end as MSW,

	            case  when  contains(upper(WASTE_TYPES_ACCEPTED),'Asb') or 

                          contains(upper(WASTE_TYPES_ACCEPTED),'Tires') or 

                          contains(upper(WASTE_TYPES_ACCEPTED),'Sludge') or 

                          contains(upper(WASTE_TYPES_ACCEPTED),'Appliances') or 

                          contains(upper(WASTE_TYPES_ACCEPTED),'Metal') or 

                          contains(upper(WASTE_TYPES_ACCEPTED),'Electronics') or 

                          contains(upper(WASTE_TYPES_ACCEPTED),'SPECIAL WASTE')   then 'Y'

                          when contains(upper(WASTE_TYPES_NOT_ACCEPTED),'SPECIAL WASTE') then 'N' 

                          else null end as SPW

      from STG.WBJ ) t1

      unpivot (ACCEPT_FLAG for WASTE_TYPE in (C_D, MSW, SPW))                                       where ACCEPT_FLAG is not null;
