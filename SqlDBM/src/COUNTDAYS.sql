-- ***************************** SqlDBM: Snowflake ****************************
-- * Generated by SqlDBM: MART SCHEMA, v18 by lesya.rylova+standard@gmail.com *


-- ************************************** COUNTDAYS
CREATE FUNCTION COUNTDAYS(START_DATE DATE, END_DATE DATE, SATURDAYS VARIANT)
RETURNS VARIANT
LANGUAGE JAVASCRIPT
AS '
  Date.prototype.addDays = function (days) {
      var date = new Date(this.valueOf());
      date.setDate(date.getDate() + days);
      return date;
  };

   var numDays = 0;
   var currentDate = new Date(START_DATE);
   while (currentDate <= END_DATE) {
        if(SATURDAYS==1)
        {
            //count Saturdays
            if (currentDate.getDay() == 6) {
                numDays++;
            }
        }
        else
        {
            //count workdays
            if (currentDate.getDay() !== 0 && currentDate.getDay() !== 6) {
                numDays++;
            }
        }
        currentDate = currentDate.addDays(1);
     };

    return numDays;
  ';
