-- ***************************** SqlDBM: Snowflake ****************************
-- * Generated by SqlDBM: MART SCHEMA, v18 by lesya.rylova+standard@gmail.com *


-- ************************************** BMT_TRANSFER_LANE_WASTE_TYPE
CREATE VIEW BMT_TRANSFER_LANE_WASTE_TYPE as

select * from

(select

LANE_ORIGIN_FAC_ID ||'_' ||case when LANE_ORIGIN_FAC_TYPE = 'Transfer Station' then 'TS'

                when LANE_ORIGIN_FAC_TYPE = 'MRF Recycling' then 'MRF'

                else LANE_ORIGIN_FAC_TYPE end as LANE_ORIGIN_FAC_ID,

WASTE_TYPE,

LANE_DESTINATION_FAC_ID ||'_' ||case when LANE_DESTINATION_FAC_TYPE = 'Transfer Station' then 'TS'

                when LANE_DESTINATION_FAC_TYPE = 'MRF Recycling' then 'MRF'

                else LANE_DESTINATION_FAC_TYPE end as LANE_DESTINATION_FAC_ID, LANE_NAME,

LONG_HAUL_COST_PER_TON ,

LONG_HAUL_COST_PER_LOAD ,

AVERAGE_LOAD_SIZE_TONS ,

STATUS_IND,

SOURCE ,

LAST_UPDATED_DTM ,

LAST_UPDATED_USER ,

DATA_COLLCTION_ADD_DELETE_UPDATE ,

MIN_TONS,

MAX_TONS,

volume_constraint_type,

volume_time_unit,

row_number() over (partition by lane_origin_fac_id, lane_origin_fac_type, waste_type,

                                lane_destination_fac_id, lane_destination_fac_type order by last_updated_dtm desc nulls last) as rnk

 from STG.FACILITY_TRANSFER_LANES_BMT_DATA_COLLCTN

 )  where rnk=1;
