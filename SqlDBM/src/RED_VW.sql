-- ***************************** SqlDBM: Snowflake ****************************
-- * Generated by SqlDBM: MART SCHEMA, v18 by lesya.rylova+standard@gmail.com *


-- ************************************** RED_VW
CREATE VIEW RED_VW  as
--
-- From OPUS.  Used to hauls per route - original CP code
--
select red.SITE_CD as DepotFacId
	, count(red.rte_num) routes 
	, sum(red.DSPSL_TRIP_CNT) disposal_trips
	, sum(red.total_equivalent_haul_num) eq_hauls
	, cast(sum(red.total_equivalent_haul_num)/count(red.rte_num) as numeric(10,2)) as eq_hauls_per_route_N
from STG.PVW_FCT_DAY_RTE_EXECUTION_DRVR red 
where red.SUB_LOB_CD like 'RO%' 
	and red.RTE_EXECUTION_SVC_DT between $start_date AND $end_date
  and (depotfacid in (select FAC_ID from MART.HAULING_SITE WHERE MARKET_AREA_CD = $MARKET_AREA))
group by DepotFacId;
