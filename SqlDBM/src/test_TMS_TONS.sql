-- ***************************** SqlDBM: Snowflake ****************************
-- * Generated by SqlDBM: MART SCHEMA, v18 by lesya.rylova+standard@gmail.com *


-- ************************************** test_TMS_TONS
CREATE VIEW test_TMS_TONS as (SELECT 
  "LANE_ORIGIN_FAC_ID", 
  "LANE_DESTINATION_FAC_ID", 
  "LONG_HAUL_COST", 
  "AVERAGE_LOAD_SIZE_TONS" 
FROM (SELECT
	ORIGIN_SITE_ID||'_TS' as LANE_ORIGIN_FAC_ID,
	DESTINATION_SITE_ID as LANE_DESTINATION_FAC_ID,
	LONG_HAUL_COST,
	AVERAGE_LOAD_SIZE_TONS
from
(
	SELECT ORIGIN_SITE_ID
		,DESTINATION_SITE_ID
		,SUM(AMOUNT) / case when SUM(TONS) = 0 then null else SUM(TONS) end as LONG_HAUL_COST
		,SUM(TONS)/(CASE WHEN SUM(LOADS) = 0 THEN NULL ELSE SUM(LOADS) END) AS AVERAGE_LOAD_SIZE_TONS
	FROM DEV_ONEWM.STG.TMS_TONS a
	WHERE to_date('01-'||a.MONTH||'-'||a.YEAR,'DD-MM-YYYY') > add_months(current_date(),-12)
	GROUP BY ORIGIN_SITE_ID, DESTINATION_SITE_ID
)
) AS "v_0000000307_0000041585");
