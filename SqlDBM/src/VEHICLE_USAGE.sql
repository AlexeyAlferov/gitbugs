-- ***************************** SqlDBM: Snowflake ****************************
-- * Generated by SqlDBM: MART SCHEMA, v18 by lesya.rylova+standard@gmail.com *


-- ************************************** VEHICLE_USAGE
CREATE VIEW VEHICLE_USAGE as (SELECT 
  "FAC_ID", 
  "SUBLOB", 
  "TRUCK_CNT" 
FROM (select FAC_ID          FAC_ID,
       SUBLOB,
       Count(distinct vehicle_id) truck_cnt
from
(
select distinct
  DEPOTFACID      FAC_ID,
  LOB,
  SUBLOB,
  vehicle_id
from DEV_ONEWM.MART.COMRES_FACT WHERE service_Dt > current_Date-365

  union all

select distinct
  DEPOTFACID      FAC_ID,
  LOB,
  SUBLOB,
  vehicle_id
from DEV_ONEWM.MART.ROLLOFF_FACT WHERE service_Dt > current_Date-365
) a where fac_Id in (select fac_Id from DEV_ONEWM.MART.HAULING_SITE)
group by 1, 2
) AS "v_0000017686_0000143911");
