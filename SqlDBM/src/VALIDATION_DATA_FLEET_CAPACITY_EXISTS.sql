-- ***************************** SqlDBM: Snowflake ****************************
-- * Generated by SqlDBM: MART SCHEMA, v18 by lesya.rylova+standard@gmail.com *


-- ************************************** VALIDATION_DATA_FLEET_CAPACITY_EXISTS
CREATE VIEW VALIDATION_DATA_FLEET_CAPACITY_EXISTS AS
SELECT  DISTINCT
       CP.DEPOTFACID
      ,CP.SUBLOB
	  ,'Hauling site ' || SUBSTR(CP.DEPOTFACID,1,6) || ' sublob ' || CP.SUBLOB ||' has no truck capacity' AS DETAIL
	  ,SUBSTR(CP.DEPOTFACID,1,6) AS LH_PARM_1
	  ,'COLLECTION'  AS LH_PARM_2
      ,NULL AS LH_PARM_3
	  ,NULL AS LH_PARM_4
	  ,NULL AS LH_PARM_5 
FROM MODEL_COLLECTION_POINTS CP
LEFT JOIN HAULING_SITE_CAPACITY HSC ON HSC.FAC_ID = substring(CP.DEPOTFACID,1,6) AND HSC.SUBLOB = CP.SUBLOB
WHERE (HSC.TRUCK_CNT IS NULL or (HSC.TRUCK_CNT is NOT NULL and HSC.TRUCK_CNT = 0)) AND (CP.DEPOTFACID != '3PDEPOT')
;
