-- ***************************** SqlDBM: Snowflake ****************************
-- * Generated by SqlDBM: MART SCHEMA, v18 by lesya.rylova+standard@gmail.com *


-- ************************************** VALIDATION_DATA_CHECK_EMPTY_WASTE_TYPE_ACCEPTANCE
CREATE VIEW VALIDATION_DATA_CHECK_EMPTY_WASTE_TYPE_ACCEPTANCE AS
SELECT
  CP.DISPFACID AS DISPOSAL_FACILITY_ID
  ,CP.WASTE_TYPE
  ,CASE WHEN FM.FAC_ID IS NULL
        THEN ('No waste type acceptance data found for ' || CP.DISPFACID ||
            ' and Waste Type ' || CP.WASTE_TYPE)
  END AS DETAIL
  ,SUBSTR(CP.DISPFACID,1,6) AS LH_PARM_1
  ,CP.WASTE_TYPE  AS LH_PARM_2
  ,NULL AS LH_PARM_3
  ,NULL AS LH_PARM_4
  ,NULL AS LH_PARM_5
FROM VALIDATION_DATA_COLLECTION_POINT_SUMMARY CP
LEFT JOIN MODEL_FACILITIES_MATERIAL FM
ON FM.FAC_ID = CP.DISPFACID
    AND FM.WASTE_TYPE = CP.WASTE_TYPE
WHERE CP.DISPFACID IS NOT NULL
    AND FM.FAC_ID IS NULL
    AND CP.TOTAL_TONNAGE > 0
;
