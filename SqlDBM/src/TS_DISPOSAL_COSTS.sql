-- ***************************** SqlDBM: Snowflake ****************************
-- * Generated by SqlDBM: MART SCHEMA, v18 by lesya.rylova+standard@gmail.com *


-- ************************************** TS_DISPOSAL_COSTS
CREATE VIEW TS_DISPOSAL_COSTS as (SELECT 
  "FAC_ID", 
  "BU_ID", 
  "LOB", 
  "TOTAL_DISPOSAL_COST", 
  "TOTAL_DISPOSAL_VOLUME", 
  "DCPT" 
FROM (SELECT RFF.FAC_IDU||'_TS' as FAC_ID
  ,BU_ID
  ,LOB
  ,TOTAL_DISPOSAL_COST
  ,TOTAL_DISPOSAL_VOLUME
  ,TOTAL_DISPOSAL_COST/(CASE WHEN TOTAL_DISPOSAL_VOLUME = 0 THEN NULL ELSE TOTAL_DISPOSAL_VOLUME END) AS DCPT
FROM
(
  SELECT
    ETC.ORGANIZATION AS BU_ID
    ,'TS' LOB
    ,SUM(D500_DISPOSAL_FEES_AND_TAXES +
        D500_A502400_REVENUE_REDUCTION_SUBCONTRACTOR_TS_FLOOR_OPS +
        D600_MAINTENANCE_LUBRICANTS +
        D600_MAINTENANCE_PARTS_AND_SUPPLIES +
        D600_A_524000_PRIMARY_SHOP_COSTS_THIRD_PARTY_REPAIRS +
        D600_A_524900_PRIMARY_SHOP_COSTS_OTHER_THIRD_PARTY_MAINTENANCE +
        D600_MAINTENANCE_TIRES +
        D600_CONTRACT_LABOR +
        D600_A514000_PRIMARY_SHOP_COSTS_EMPLOYER_401K_MATCHING +
        D600_A514950_PRIMARY_SHOP_COSTS_PENSION_EXPENSE_UNION +
        D600_PAYROLL_TAX_EXPENSE +
        D600_WAGES_HOURLY +
        D600_WAGES_OVERTIME +
        D600_FUEL +
        D780_A571100_LANDFILL_ROYALTIES_AIRSPACE_HOST_COMMUNITY_FEES +
        D780_A571300_LANDFILL_ROYALTIES_IRSPACE_LF_LEASE_CONTINGENT_PAYMENTS +
        D780_ROYALTIES
    ) AS TOTAL_DISPOSAL_COST
    ,SUM(TOTAL_EXTERNAL_TONS + TOTAL_INTERNAL_TONS) AS TOTAL_DISPOSAL_VOLUME
  FROM DEV_ESSBASE.ODS.ESSBASE_TRANSFER_COST ETC
  WHERE to_date('01-'||TIME,'DD-MON-YY') > add_months(current_date(),-12)
  GROUP BY ETC.ORGANIZATION,  'TS'
) DCPT
LEFT JOIN
(
  SELECT DISTINCT FAC_BUS_UNIT_IDU, FAC_IDU FROM DEV_CORPDB.ODS.RDN2_FAC_FULL
) RFF
ON DCPT.BU_ID = RFF.FAC_BUS_UNIT_IDU



) AS "v_0000017686_0000143777");
