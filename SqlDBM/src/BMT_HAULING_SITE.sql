-- ***************************** SqlDBM: Snowflake ****************************
-- * Generated by SqlDBM: MART SCHEMA, v18 by lesya.rylova+standard@gmail.com *


-- ************************************** BMT_HAULING_SITE
CREATE VIEW BMT_HAULING_SITE as
select * from
(select
FAC_ID ,
FAC_TYPE,
WM_OWNED_FLAG,
FAC_NAME,
FAC_SHORT_NM,
ACTIVE_FLAG,
MARKET_AREA_NM,
MARKET_AREA_CD,
LATITUDE,
LONGITUDE,
ADDRESS_1,
ADDRESS_2,
CITY_NM,
STATE_CD,
ZIP_CD,
COUNTRY,
COUNTY_NM,
FIXED_COST,
UNIT_COST,
LAST_UPDATED_DTM,
LAST_UPDATED_USER,
DATA_COLLCTION_ADD_DELETE_UPDATE,
row_number() over (partition by fac_id, fac_type order by last_updated_dtm desc nulls last) as rnk,
GEO_CITY_NM,
GEO_COUNTY_NM,
GEO_STATE_CD,
GEO_ZIP_CD
 from stg.FACILITY_LOCATION_DATA_BMT_DATA_COLLCTN
 where fac_type = 'Collection')  where rnk=1;
