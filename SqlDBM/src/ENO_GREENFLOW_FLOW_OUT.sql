-- ***************************** SqlDBM: Snowflake ****************************
-- * Generated by SqlDBM: MART SCHEMA, v18 by lesya.rylova+standard@gmail.com *


-- ************************************** ENO_GREENFLOW_FLOW_OUT
CREATE VIEW ENO_GREENFLOW_FLOW_OUT as
SELECT
  T1.ENO_ID
  ,T1.ROWNUM AS COLLECTION_POINT_ID
  ,T1.FROM_TYPE
  ,EGS.LOB
  ,T1.LOB as SUBLOB
  ,T1.WASTE_TYPE
--DEPOT
  ,T1.SITE_ID                 AS DEPOT_FAC_ID
  ,EGS.B_DEPOT_FAC_TYPE       AS DEPOT_FAC_TYPE
  ,EGS.B_DEPOT_FAC_NAME       AS DEPOT_FAC_NAME
  ,EGS.B_DEPOT_FAC_SHORT_NM   AS DEPOT_FAC_SHORT_NM
  ,EGS.B_DEPOT_WM_OWNED_FLAG  AS DEPOT_WM_OWNED_FLAG
  ,EGS.B_DEPOT_LATITUDE       AS DEPOT_LATITUDE
  ,EGS.B_DEPOT_LONGITUDE      AS DEPOT_LONGITUDE
  ,EGS.B_DEPOT_GEO_CITY_NM    AS DEPOT_GEO_CITY_NM
  ,EGS.B_DEPOT_GEO_COUNTY_NM  AS DEPOT_GEO_COUNTY_NM
  ,EGS.B_DEPOT_GEO_STATE_CD   AS DEPOT_GEO_STATE_CD
  ,EGS.B_DEPOT_GEO_ZIP_CD     AS DEPOT_GEO_ZIP_CD
--DISPOSAL
  ,T1.TO_ID AS DISP_FAC_ID
  ,MFP2.FAC_TYPE AS DISP_FAC_TYPE
  ,MFP2.FAC_NAME AS DISP_FAC_NAME
  ,NVL(MFP2.FAC_SHORT_NM, MFP2.FAC_NAME) AS DISP_FAC_SHORT_NM
  ,MFP2.WM_OWNED_FLAG AS DISP_WM_OWNED_FLAG
  ,MFP2.LATITUDE AS DISP_LATITUDE
  ,MFP2.LONGITUDE AS DISP_LONGITUDE
  ,MFP2.GEO_CITY_NM AS DISP_GEO_CITY_NM
  ,MFP2.GEO_COUNTY_NM AS DISP_GEO_COUNTY_NM
  ,MFP2.GEO_STATE_CD AS DISP_GEO_STATE_CD
  ,MFP2.GEO_ZIP_CD AS DISP_GEO_ZIP_CD
--TS
  ,T1.FROM_ID AS TS_FAC_ID
  ,MFP3.FAC_TYPE AS TS_FAC_TYPE
  ,MFP3.FAC_NAME AS TS_FAC_NAME
  ,NVL(MFP3.FAC_SHORT_NM, MFP3.FAC_NAME) AS TS_FAC_SHORT_NM
  ,MFP3.WM_OWNED_FLAG AS TS_WM_OWNED_FLAG
  ,MFP3.LATITUDE AS TS_LATITUDE
  ,MFP3.LONGITUDE AS TS_LONGITUDE
  ,MFP3.GEO_CITY_NM AS TS_GEO_CITY_NM
  ,MFP3.GEO_COUNTY_NM AS TS_GEO_COUNTY_NM
  ,MFP3.GEO_STATE_CD AS TS_GEO_STATE_CD
  ,MFP3.GEO_ZIP_CD AS TS_GEO_ZIP_CD
--
  ,T1.TONS
  ,EGS.LOADS
  ,T1.COST
  ,T1.DOLLAR_PER_HR
  ,T1.ROUTE_TIME
  ,T1.CP_ID
  ,T1.ENO_RESULTSOURCE
  ,EGS.ROUTE_ID
  ,EGS.LOAD_SEQ
  ,EGS.LOAD_TYPE
  ,EGS.ACCOUNT_NBR
  ,EGS.CUSTOMER_NAME
  ,EGS.CP_LATITUDE
  ,EGS.CP_LONGITUDE
  ,EGS.CP_GEO_CITY_NM
  ,EGS.CP_GEO_COUNTY_NM
  ,EGS.CP_GEO_STATE_CD
  ,EGS.CP_GEO_ZIP_CD
  ,EGS.STEM_LEGS
  ,EGS.RETURN_LEGS
  ,EGS.DISPOSAL_LEGS
FROM STG.ENO_GREENFLOW_FLOW_OUT T1
LEFT JOIN MART.ENO_GREENFLOW_SOLUTION_RESULTS_VW EGS
ON T1.ENO_ID = EGS.ENO_ID
  AND T1.ROWNUM = EGS.COLLECTION_POINT_ID
LEFT JOIN MART.MODEL_FACILITIES_PERSISTENT MFP2
ON MFP2.ENO_ID = T1.ENO_ID
  AND MFP2.FAC_ID = T1.TO_ID
LEFT JOIN MART.MODEL_FACILITIES_PERSISTENT MFP3
ON MFP3.ENO_ID = T1.ENO_ID
  AND MFP3.FAC_ID = T1.FROM_ID
;
