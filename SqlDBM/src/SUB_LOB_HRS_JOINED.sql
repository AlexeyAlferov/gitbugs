-- ***************************** SqlDBM: Snowflake ****************************
-- * Generated by SqlDBM: MART SCHEMA, v18 by lesya.rylova+standard@gmail.com *


-- ************************************** SUB_LOB_HRS_JOINED
CREATE VIEW SUB_LOB_HRS_JOINED AS

SELECT

    r.HAULING_SITE

    ,r.SUBLOB

    ,cmr.SUBLOB AS CLEAN_SUBLOB

    ,r.TOTAL_DURATION_HRS

    ,COALESCE(sdr.STEM_DISPOSAL_RETURN_HRS,0) AS STEM_DISPOSAL_RETURN_HRS

    ,(r.TOTAL_DURATION_HRS - COALESCE(sdr.STEM_DISPOSAL_RETURN_HRS,0)) AS TOTAL_COLLECTION_HRS

FROM SUBLOB_TOTAL_ROUTE_DURATION_HRS r

LEFT JOIN SUBLOB_STEM_DISPOSAL_RETURN_HRS sdr

    ON r.HAULING_SITE=sdr.HAULING_SITE AND r.SUBLOB=sdr.SUBLOB

LEFT JOIN COMRES_WASTETYPE_MAPPING cmr ON r.SUBLOB=cmr.SUBLOB;
